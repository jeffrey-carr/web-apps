import{t as C,a as w,b as Q}from"./xZr1-Uvj.js";import{p as N,a as P,A as x,y as W,v as D,w as S,t as I,g as s,s as V,x as L,C as R}from"./C3n9QEEV.js";import{d as X,e as Y,s as Z}from"./3uQZxb5k.js";import{p as U,b as p,i as j}from"./fOfYy8UT.js";import{b as $,r as ee,e as te,i as ne,c as B,d as ae,s as ie}from"./B_ZxHtlc.js";var se=C('<div class="container svelte-j9s6cv"><div class="timer svelte-j9s6cv"></div></div>');function le(k,n){N(n,!0);let v=W(100),m;P(()=>{if(!n.until)return;const _=()=>{const b=new Date().getTime(),h=new Date(n.until).getTime(),y=Math.max(0,h-b);x(v,y/5e3*100),y<=0&&(clearInterval(m),x(v,0))};return _(),m=setInterval(_,50),()=>clearInterval(m)});var T=se(),i=D(T);S(T),I(()=>$(i,`--progress: ${s(v)}%`)),w(k,T),V()}const oe=(k,n)=>{const v=k.currentTarget;setTimeout(()=>{(v.selectionStart||0)<n()&&v.setSelectionRange(n(),n())},0)};var re=C('<div class="timer-container svelte-k63luy"><!></div>'),ce=C("<div><!></div>"),ue=C('<div class="container svelte-k63luy"><input class="input svelte-k63luy" type="text"> <div><!> <!></div></div>');function _e(k,n){N(n,!0);let v=U(n,"word",3,""),m=U(n,"locked",3,!1),T=U(n,"correct",3,!1),i=U(n,"revealedLetters",3,1);const _="timed-out";let b=R(()=>v().split("")),h=R(()=>n.targetWord.split("")),y=R(()=>m()?"":"active"),g=W(""),H=R(()=>T()?"correct":""),f=W(void 0),M;P(()=>{var e;!m()&&!s(g)&&((e=s(f))==null||e.focus(),s(f)&&s(f).value.length>0&&setTimeout(()=>{var a,l;const t=Math.max(i(),((a=s(f))==null?void 0:a.value.length)??1);(l=s(f))==null||l.setSelectionRange(t,t)},0))}),P(()=>{if(n.timedOutUntil!=null){clearTimeout(M);const e=new Date,t=new Date(n.timedOutUntil);if(isNaN(t.getTime()))return;const a=Math.max(0,t.getTime()-e.getTime());if(a===0)return;x(g,_),M=setTimeout(K,a)}return()=>clearTimeout(M)});const K=()=>{var e;x(g,""),m()||(e=s(f))==null||e.focus()},q=e=>{var u;if(s(g)===_)return;const t=e.currentTarget,a=t.value,l=t.selectionStart||0;let d="",c=!1;for(let o=0;o<Math.max(a.length,i());o++)o<i()?d+=n.targetWord[o]:o<a.length&&(d+=a[o]);if(d!==a&&(t.value=d,c=!0),c){const o=Math.max(i(),l);setTimeout(()=>{t.setSelectionRange(o,o)},0)}(u=n.onUpdate)==null||u.call(n,t.value)},z=e=>{var d;const t=e.currentTarget,a=t.selectionStart||0,l=t.selectionEnd||0;if((e.key==="Backspace"&&a<=i()&&l<=i()||e.key==="Delete"&&a<i()&&l<i()||l>0&&a<i()&&(e.key==="Backspace"||e.key==="Delete"||e.key.length===1))&&(e.preventDefault(),e.key.length===1&&a<i()&&l>i()-1)){let c="";for(let u=0;u<i();u++)c+=n.targetWord[u];c+=e.key,l<t.value.length&&(c+=t.value.substring(l)),t.value=c,setTimeout(()=>{t.setSelectionRange(i()+1,i()+1)},0),(d=n.onUpdate)==null||d.call(n,c)}e.key==="Home"&&(e.preventDefault(),setTimeout(()=>{t.setSelectionRange(i(),i())},0)),e.key==="ArrowLeft"&&a<=i()&&(e.preventDefault(),setTimeout(()=>{t.setSelectionRange(i(),i())},0))},F=e=>{const t=e.currentTarget,a=t.selectionStart??0,l=t.selectionEnd??0;a<i()&&setTimeout(()=>{t.setSelectionRange(i(),l)},0)};var O=ue(),r=D(O);ee(r),r.__input=q,r.__keydown=z,r.__click=[oe,i],p(r,e=>x(f,e),()=>s(f));var E=L(r,2),A=D(E);{var G=e=>{var t=re(),a=D(t);le(a,{get until(){return n.timedOutUntil}}),S(t),w(e,t)};j(A,e=>{n.timedOutUntil&&n.timedOutUntil>new Date().getTime()&&e(G)})}var J=L(A,2);te(J,17,()=>s(h),ne,(e,t,a)=>{var l=ce(),d=D(l);{var c=u=>{var o=Q();I(()=>Z(o,s(b)[a])),w(u,o)};j(d,u=>{a<s(b).length&&u(c)})}S(l),I(()=>B(l,1,`letter ${a===0?"left":""} ${a===s(h).length-1?"right":""} ${s(y)} ${s(H)} ${a<i()?"revealed":""}`,"svelte-k63luy")),w(e,l)}),S(E),S(O),I(()=>{ae(r,v()),r.disabled=m()||s(g)===_,ie(r,"maxlength",s(h).length),B(E,1,`letters-container ${s(y)} ${s(g)}`,"svelte-k63luy")}),Y("select",r,F),w(k,O),V()}X(["input","keydown","click"]);export{_e as W};
