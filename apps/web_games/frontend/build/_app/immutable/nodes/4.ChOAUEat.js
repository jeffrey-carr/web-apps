import{t as q,a as u,b as y,c as Z}from"../chunks/xZr1-Uvj.js";import{p as x,y as v,z as C,a as ee,s as te,A as o,v as g,x as m,g as e,B as T,w as p,q as ae,C as S}from"../chunks/C3n9QEEV.js";import{i as U}from"../chunks/fOfYy8UT.js";import{M as D,a as re,B as W,e as se,s as oe,i as ne}from"../chunks/B_ZxHtlc.js";import{M as ie,m as O,C as de}from"../chunks/B2ig8wVz.js";import"../chunks/CbiwTDX5.js";import{W as le}from"../chunks/CGXT1v-R.js";const B={NEW_GAME:{path:"/api/word-chain/new-game",method:D.GET},VALIDATE_ANSWER:{path:"/api/word-chain/validate-answer",method:D.POST}};var ce=q('<div class="correct-message svelte-1gceqla"><h1 class="svelte-1gceqla">Correct!</h1> <p>Would you like to play again?</p> <div class="buttons-container svelte-1gceqla"><!> <!></div></div>'),ue=q('<div class="word svelte-1gceqla"><!></div>'),ve=q('<div class="container svelte-1gceqla"><!> <!> <!> <div class="info-center svelte-1gceqla"><div class="title svelte-1gceqla"><h1>Word Chain <span class="subtext svelte-1gceqla">BETA</span></h1></div> <div class="buttons-container"><!></div></div> <div class="words-column svelte-1gceqla"><!></div></div>');function Ce(R,z){x(z,!0);const I=5e3;let r=v(void 0),$=v(""),V=v(C([])),c=v(C([])),w=v(C([])),i=v(C([])),f=v(!1);ee(()=>{if(!e(r)){o($,"");return}o(V,[...e(r).data.generatedChain.slice(0,e(r).data.userProgress)],!0);const t=Array(e(r).data.generatedChain.length).fill("").map((a,s)=>s===0||e(r).data.userProgress>s?e(r).data.generatedChain[s]:e(r).data.generatedChain[s].slice(0,e(i)[s]));if(o(c,t,!0),e($)!==e(r).data.uuid){o($,e(r).data.uuid,!0);const a=Array(e(r).data.generatedChain.length).fill(0);o(w,a,!0);const s=Array(e(r).data.generatedChain.length).fill(1);s[0]=e(r).data.generatedChain[0].length,o(i,s,!0)}});const G=async()=>{const t=await O(B.NEW_GAME);if(t.status!==200){console.error("error getting new game",t);return}o(r,await t.json(),!0)},j=(t,a)=>{if(!e(r)){console.error("Cannot update guess - no game");return}if(e(w)[a]>new Date().getTime())return;if(t.length===0){t=e(r).data.generatedChain[a].substring(0,e(i)[a]),e(c)[a]=t;return}const s=e(r).data.generatedChain[a].substring(0,e(i)[a]);t.startsWith(s)||(t=s+t.substring(e(i)[a])),t=t.toUpperCase(),t!==e(c)[a]&&(e(c)[a]=t,e(c)[a].length===e(r).data.generatedChain[a].length&&H(t,a))},H=async(t,a)=>{if(!e(r)){console.error("Could not submit guess - no game");return}const s=await O(B.VALIDATE_ANSWER,{body:{guess:t,gameState:e(r)}});if(s.status!==200){console.error("error in request",s);return}const d=await s.json();if(d.correct)o(r,d.updatedGame,!0),d.victory&&o(f,!0);else{e(w)[a]=new Date().getTime()+I;const h=e(r).data.generatedChain[a].length;e(i)[a]<h-1&&e(i)[a]++,e(c)[a]=e(r).data.generatedChain[a].substring(0,e(i)[a])}};var b=ve(),P=g(b);{var J=t=>{de(t,{})};U(P,t=>{e(f)&&t(J)})}var M=m(P,2);re(M,{get open(){return e(f)},set open(t){o(f,t,!0)},children:(t,a)=>{var s=ce(),d=m(g(s),4),h=g(d);W(h,{size:"medium",onclick:G,children:(l,E)=>{T();var _=y("New Game");u(l,_)},$$slots:{default:!0}});var n=m(h,2);W(n,{size:"medium",type:"secondary",onclick:()=>{o(f,!1)},children:(l,E)=>{T();var _=y("View board");u(l,_)},$$slots:{default:!0}}),p(d),p(s),u(t,s)},$$slots:{default:!0}});var N=m(M,2);ie(N,{});var A=m(N,2),k=m(g(A),2),Y=g(k);W(Y,{onclick:G,size:"medium",children:(t,a)=>{T();var s=y("New Game");u(t,s)},$$slots:{default:!0}}),p(k),p(A);var L=m(A,2),F=g(L);{var K=t=>{var a=Z(),s=ae(a);se(s,17,()=>e(r).data.generatedChain,ne,(d,h,n)=>{var l=ue();oe(l,"id",`word-${n}`);var E=g(l);const _=S(()=>n!==0&&n<e(r).data.userProgress),Q=S(()=>n!==e(r).data.userProgress);le(E,{get word(){return e(c)[n]},get targetWord(){return e(h)},onUpdate:X=>j(X,n),get correct(){return e(_)},get locked(){return e(Q)},get timedOutUntil(){return e(w)[n]},get revealedLetters(){return e(i)[n]}}),p(l),u(d,l)}),u(t,a)};U(F,t=>{e(r)&&t(K)})}p(L),p(b),u(R,b),te()}export{Ce as component};
